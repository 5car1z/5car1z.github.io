<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="description" content="Linux System Administration"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="alternative" href="/atom.xml" title="C.J. Scarlett" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>Ansible - Inventory Concepts (2) - C.J. Scarlett</title><link rel="stylesheet" href="/css/main.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--></head><body><header class="head"><h1 class="head-title u-fl"><a href="/">C.J. Scarlett</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a href="/" class="head-nav__link">Home</a></li><li class="head-nav__item"><a href="/topics" class="head-nav__link">Topics</a></li><li class="head-nav__item"><a href="/archives" class="head-nav__link">Archives</a></li><li class="head-nav__item"><a href="/misc" class="head-nav__link">Misc</a></li><li class="head-nav__item"><a href="/about" class="head-nav__link">About</a></li><li class="head-nav__item"><a href="/contact" class="head-nav__link">Contact</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"><time datetime="2016-06-26T23:00:00.000Z" class="post__time">June 27, 2016</time><h1 class="post__title"><a href="/2016/06/27/ansible-inventory-concepts/">Ansible - Inventory Concepts (2)</a></h1></header><div class="post__main echo"><p><img src="http://i.imgur.com/9HBs9cy.png" alt="Ansible Logo"></p>
<h1 id="Preamble"><a href="#Preamble" class="headerlink" title="Preamble"></a>Preamble</h1><p>After outlining the initial installation and setup process in <a href="http://www.tricksofthetrades.net/2016/02/10/ansible-installing-running/">Ansible - Installing and Running (1)</a> I’m continuing in this post with a more precise look at how to handle the main hosts file. Specifically how to lay it out and add host variables or group variables to the mix. Dynamic inventory assets and development/production inventory layouts are not covered here and only alluded to or linked to. </p>
<p>Lastly splitting up the variable types and their definitions into their own YAML files is briefly introduced in the final step, and works best for more complex network hierarchies. </p>
<a id="more"></a>
<hr>
<h1 id="1-–-Hosts-Inventory-File"><a href="#1-–-Hosts-Inventory-File" class="headerlink" title="1 –  Hosts Inventory File"></a>1 –  Hosts Inventory File</h1><p>As shown in “Ansible - Installing and Running (1)” Ansible operates by working simultaneously with multiple hosts in your infrastructure. It’s preferred way of doing this is to allocate hosts into different groups inside of the inventory file - <code>/etc/ansible/hosts</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ls /etc/ansible/</span><br><span class="line"></span><br><span class="line">ansible.cfg  hosts  hosts.orig  roles</span><br></pre></td></tr></table></figure>
<p>This file is completely configurable and can be expanded or broken up into multiple inventory files.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vim /etc/ansible/hosts</span><br></pre></td></tr></table></figure>
<p>There’s a special form of inventory in Ansible known as <em>dynamic inventory</em> that refers to inventory files or asserts that get pulled down from the cloud, or other server side sources. This is not covered in this post however. </p>
<hr>
<h1 id="2-–-Hosts-and-Groups"><a href="#2-–-Hosts-and-Groups" class="headerlink" title="2 – Hosts and Groups"></a>2 – Hosts and Groups</h1><p>As seen in the first post, the INI style formatting for an Ansible hosts file looks similar to this:</p>
<figure class="highlight yaml"><figcaption><span>/etc/ansible/hosts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[webservers]</span></span><br><span class="line"><span class="string">webremote.one.ip.address</span></span><br><span class="line"><span class="string">webremote.two.ip.address</span></span><br><span class="line"><span class="string">webremote.three.ip.address</span></span><br><span class="line"></span><br><span class="line"><span class="string">[dbservers]</span></span><br><span class="line"><span class="string">dbremote.one.ip.address</span></span><br><span class="line"><span class="string">dbremote.two.ip.address</span></span><br><span class="line"><span class="string">dbremote.three.ip.address</span></span><br></pre></td></tr></table></figure>
<p>Square brackets <code>[ ]</code> contain a group name which is used to decide what systems you are controlling at what times and for what purpose. This makes it possible to apply actions to specific nodes/hosts as and when necessary. </p>
<p>Also systems (nodes/hosts) can be attributed under more than one group if needed, so in the snippet above one of the example nodes could be both a web server <strong>and</strong> a database server, added to both group entries in the file.</p>
<p>The hostnames can also be domain names instead of raw IP addresses if preferred, and when adding a large numbers of hosts if the domain names follow a similar numerical pattern, you can use ranges of numbers instead of adding them all individually. </p>
<figure class="highlight yaml"><figcaption><span>/etc/ansible/hosts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[webservers]</span></span><br><span class="line"><span class="string">www[01:50].example.com</span></span><br></pre></td></tr></table></figure>
<p>Lastly hosts that run on non-standard SSH ports i.e. not <code>22</code> must have the their custom SSH port numbers inserted after the hostname separated by a colon.</p>
<p>For example:</p>
<p><code>webremote.one.ip.address:3675</code></p>
<p>Or instead defined through host/group variables (see next step). </p>
<hr>
<h1 id="3-–-Host-and-Group-Variables"><a href="#3-–-Host-and-Group-Variables" class="headerlink" title="3 – Host and Group Variables"></a>3 – Host and Group Variables</h1><p>Variables in the inventory file(s) are set on a host basis or group basis. There are many of these inbuilt variables on offer to the user when constructing the file. </p>
<p>Here is an example of two host variables, that explicitly tell Ansible to use SSH as the connection type, with a set username:</p>
<figure class="highlight yaml"><figcaption><span>/etc/ansible/hosts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[webservers]</span></span><br><span class="line"><span class="string">webremote.one.ip.address</span> <span class="string">ansible_connection=ssh</span> <span class="string">ansible_user=username</span> </span><br><span class="line"><span class="string">webremote.two.ip.address</span> <span class="string">ansible_connection=ssh</span> <span class="string">ansible_user=username</span> </span><br><span class="line"><span class="string">webremote.three.ip.address</span> <span class="string">ansible_connection=ssh</span> <span class="string">ansible_user=username</span> </span><br><span class="line"></span><br><span class="line"><span class="string">[dbservers]</span></span><br><span class="line"><span class="string">dbremote.one.ip.address</span> <span class="string">ansible_connection=ssh</span> <span class="string">ansible_user=username</span> </span><br><span class="line"><span class="string">dbremote.two.ip.address</span> <span class="string">ansible_connection=ssh</span> <span class="string">ansible_user=username</span> </span><br><span class="line"><span class="string">dbremote.three.ip.address</span> <span class="string">ansible_connection=ssh</span> <span class="string">ansible_user=username</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>Note:</strong> <code>username</code> would be replaced by the actual Ansible user on these hosts in the above.</p>
</blockquote>
<p>In the first post on Ansible I laid out these host variables and the file formatting differently, by using:</p>
<ul>
<li>An “empty” name for the hosts - <code>server-name-1</code></li>
<li>A host variable that then gives this name an IP address to refer to - <code>ansible_host=remote.one.ip.address</code></li>
<li>Another host variable with the specific username like in the previous example - <code>ansible_user=username</code></li>
<li>Then a final host variable that holds the custom SSH port to use when connecting to this host - <code>ansible_port=3980</code></li>
</ul>
<p>Here is what the layout looked like for this file:</p>
<figure class="highlight yaml"><figcaption><span>/etc/ansible/hosts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[servers]</span></span><br><span class="line"><span class="string">server-name-1</span> <span class="string">ansible_host=remote.one.ip.address</span> <span class="string">ansible_user=username</span> <span class="string">ansible_port=3980</span> </span><br><span class="line"><span class="string">server-name-2</span> <span class="string">ansible_host=remote.one.ip.address</span> <span class="string">ansible_user=username</span> <span class="string">ansible_port=3980</span> </span><br><span class="line"><span class="string">server-name-3</span> <span class="string">ansible_host=remote.one.ip.address</span> <span class="string">ansible_user=username</span> <span class="string">ansible_port=3980</span></span><br></pre></td></tr></table></figure>
<p>Group variables allow extra options and settings like in the above to be applied to an entire group at once. Instead of having to set the same variables for each host when the value of the variables is the same. </p>
<p>These are defined by creating a new set of square brackets <code>[ ]</code> that contain the group name you wish to apply the variables to, followed by a <em>tag</em> that consists of a <code>:</code> and the term <code>vars</code> .</p>
<p>When put together using a group named “webservers” this makes - <code>[webservers:vars]</code> </p>
<p>The variables you want to apply to the group are then listed on separate lines - an example of all of this is shown in the below code snippet:</p>
<figure class="highlight yaml"><figcaption><span>/etc/ansible/hosts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[webservers]</span></span><br><span class="line"><span class="string">webremote.one.ip.address</span></span><br><span class="line"><span class="string">webremote.two.ip.address</span></span><br><span class="line"><span class="string">webremote.three.ip.address</span></span><br><span class="line"></span><br><span class="line"><span class="string">[webservers:vars]</span></span><br><span class="line"><span class="string">ansible_user=username</span> </span><br><span class="line"><span class="string">ansible_port=3980</span> </span><br><span class="line"><span class="string">ntp_server=ntp.example.com</span></span><br><span class="line"><span class="string">proxy=proxy.example.com</span></span><br><span class="line"></span><br><span class="line"><span class="string">[dbservers]</span></span><br><span class="line"><span class="string">dbremote.one.ip.address</span></span><br><span class="line"><span class="string">dbremote.two.ip.address</span></span><br><span class="line"><span class="string">dbremote.three.ip.address</span></span><br><span class="line"></span><br><span class="line"><span class="string">[dbservers:vars]</span></span><br><span class="line"><span class="string">ansible_user=username</span> </span><br><span class="line"><span class="string">ansible_port=3980</span> </span><br><span class="line"><span class="string">ntp_server=ntp.example.com</span></span><br><span class="line"><span class="string">proxy=proxy.example.com</span></span><br></pre></td></tr></table></figure>
<hr>
<h1 id="4-–-Groups-of-Groups"><a href="#4-–-Groups-of-Groups" class="headerlink" title="4 – Groups of Groups"></a>4 – Groups of Groups</h1><p>There’s a further way of making “groups out of groups” by using the <code>:children</code> tag. These can have group variables applied to them too by using the same method in the last step. To do this extra grouping, a new group name is created then suffixed with the <code>:children</code> tag which will contain the original groups defined.</p>
<p>Such as here:</p>
<figure class="highlight yaml"><figcaption><span>/etc/ansible/hosts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[webservers-one]</span></span><br><span class="line"><span class="string">webremote.one.ip.address</span></span><br><span class="line"><span class="string">webremote.two.ip.address</span></span><br><span class="line"><span class="string">webremote.three.ip.address</span></span><br><span class="line"></span><br><span class="line"><span class="string">[dbservers-one]</span></span><br><span class="line"><span class="string">dbremote.one.ip.address</span></span><br><span class="line"><span class="string">dbremote.two.ip.address</span></span><br><span class="line"><span class="string">dbremote.three.ip.address</span></span><br><span class="line"></span><br><span class="line"><span class="string">[cluster-one:children]</span></span><br><span class="line"><span class="string">webservers-one</span></span><br><span class="line"><span class="string">dbservers-two</span></span><br></pre></td></tr></table></figure>
<p>To add group variables to this new group of a group, the new name is added to yet another group with the standard <code>:vars</code> tag.</p>
<p>Like at the bottom of this code snippet:</p>
<figure class="highlight yaml"><figcaption><span>/etc/ansible/hosts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[webservers-one]</span></span><br><span class="line"><span class="string">webremote.one.ip.address</span></span><br><span class="line"><span class="string">webremote.two.ip.address</span></span><br><span class="line"><span class="string">webremote.three.ip.address</span></span><br><span class="line"></span><br><span class="line"><span class="string">[dbservers-one]</span></span><br><span class="line"><span class="string">dbremote.one.ip.address</span></span><br><span class="line"><span class="string">dbremote.two.ip.address</span></span><br><span class="line"><span class="string">dbremote.three.ip.address</span></span><br><span class="line"></span><br><span class="line"><span class="string">[cluster-one:children]</span></span><br><span class="line"><span class="string">webservers-one</span></span><br><span class="line"><span class="string">dbservers-two</span></span><br><span class="line"></span><br><span class="line"><span class="string">[cluster-one:vars]</span></span><br><span class="line"><span class="string">ansible_user=username</span> </span><br><span class="line"><span class="string">ansible_port=3980</span> </span><br><span class="line"><span class="string">ntp_server=ntp.example.com</span></span><br><span class="line"><span class="string">proxy=proxy.example.com</span></span><br></pre></td></tr></table></figure>
<p>The concept of grouping groups into more groups can theoretically go on indefinitely. Another level of grouping is added below to demonstrate:</p>
<figure class="highlight yaml"><figcaption><span>/etc/ansible/hosts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[webservers-one]</span></span><br><span class="line"><span class="string">webremote.one.ip.address</span></span><br><span class="line"><span class="string">webremote.two.ip.address</span></span><br><span class="line"><span class="string">webremote.three.ip.address</span></span><br><span class="line"></span><br><span class="line"><span class="string">[dbservers-one]</span></span><br><span class="line"><span class="string">dbremote.one.ip.address</span></span><br><span class="line"><span class="string">dbremote.two.ip.address</span></span><br><span class="line"><span class="string">dbremote.three.ip.address</span></span><br><span class="line"></span><br><span class="line"><span class="string">[cluster-one:children]</span></span><br><span class="line"><span class="string">webservers-one</span></span><br><span class="line"><span class="string">dbservers-two</span></span><br><span class="line"></span><br><span class="line"><span class="string">[cluster-one:vars]</span></span><br><span class="line"><span class="string">ansible_user=username</span> </span><br><span class="line"><span class="string">ansible_port=3980</span> </span><br><span class="line"><span class="string">ntp_server=ntp.example.com</span></span><br><span class="line"><span class="string">proxy=proxy.example.com</span></span><br><span class="line"><span class="string">[webservers-two]</span></span><br><span class="line"></span><br><span class="line"><span class="string">webremote.one.ip.address</span></span><br><span class="line"><span class="string">webremote.two.ip.address</span></span><br><span class="line"><span class="string">webremote.three.ip.address</span></span><br><span class="line"></span><br><span class="line"><span class="string">[dbservers-two]</span></span><br><span class="line"><span class="string">dbremote.one.ip.address</span></span><br><span class="line"><span class="string">dbremote.two.ip.address</span></span><br><span class="line"><span class="string">dbremote.three.ip.address</span></span><br><span class="line"></span><br><span class="line"><span class="string">[cluster-two:children]</span></span><br><span class="line"><span class="string">webservers-two</span></span><br><span class="line"><span class="string">dbservers-two</span></span><br><span class="line"></span><br><span class="line"><span class="string">[cluster-two:vars]</span></span><br><span class="line"><span class="string">ansible_user=username</span> </span><br><span class="line"><span class="string">ansible_port=3980</span> </span><br><span class="line"><span class="string">ntp_server=ntp.example.com</span></span><br><span class="line"><span class="string">proxy=proxy.example.com</span></span><br><span class="line"></span><br><span class="line"><span class="string">[all-clusters:children]</span></span><br><span class="line"><span class="string">cluster-one</span></span><br><span class="line"><span class="string">cluster-two</span></span><br></pre></td></tr></table></figure>
<p>More realistically this could be seen in terms of grouping local data-centre hosts into regions and then into a country wide group. </p>
<hr>
<h1 id="5-–-Multiple-Inventory-Files"><a href="#5-–-Multiple-Inventory-Files" class="headerlink" title="5 – Multiple Inventory Files"></a>5 – Multiple Inventory Files</h1><p>The singular <code>/etc/ansible/hosts</code> file is fine for smaller more contained network setups, but the preferred practice in Ansible is not to store variables in the main <code>hosts</code> inventory file. At least when dealing with larger more complex layouts of hosts, or bigger networks. </p>
<p>Host and group variables ideally when handling large scale setups should be stored in individual files. Files that are relative to the main inventory file.</p>
<p>As an example any group variables defined in the below file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/ansible/group_vars/webservers.yml</span><br></pre></td></tr></table></figure>
<p>Will apply to any hosts located in the <code>webservers</code> group. These variable files are written in YAML.</p>
<p>Similarly any host variables defined in:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/ansible/host_vars/server-name-1.yml</span><br></pre></td></tr></table></figure>
<p>Are applied to the host named <code>server-name-1</code> from the original <code>hosts</code> file. </p>
<p>Further segmentation and organisation of the host/inventory files is followed but not covered in this post, see <a href="http://rosstuck.com/multistage-environments-with-ansible/" target="_blank" rel="external">Multistage Environments with Ansible</a> for more information on how this is done.</p>
<hr>
<p>A future third post on Ansible will describe the <em>modules</em> in place that can be run as part of a playbook, or as ad-hoc based commands. </p>
<p><a href="http://www.tricksofthetrades.net/trades/">Links to subsequent Ansible posts can be found on the Trades page.</a></p>
<p><strong>More Information</strong></p>
<ul>
<li><a href="http://docs.ansible.com/ansible/intro_inventory.html" target="_blank" rel="external">Official Ansible Documentation - Inventory</a> – The concepts on this page are what I based most of this blosg post on. </li>
<li><a href="http://docs.ansible.com/ansible/playbooks_best_practices.html" target="_blank" rel="external">Official Ansible Documentation - Best Practices: Content Organisation</a> – Not as relevant but </li>
</ul>
<blockquote>
<p>Easily deploy an SSD cloud server on <a href="https://www.digitalocean.com/?refcode=e91058dbfc7b" target="_blank" rel="external">Digital Ocean</a> in 55 seconds. Sign up using my link and receive $10.00 in free credit: <a href="https://www.digitalocean.com/?refcode=e91058dbfc7b" target="_blank" rel="external">https://www.digitalocean.com/?refcode=e91058dbfc7b</a></p>
</blockquote>
<p>– Scarlz: <a href="https://twitter.com/5car1z" target="_blank" rel="external">@5car1z</a></p>
</div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/Ansible/" class="post__tag__link">Ansible</a></li><li class="post__tag__item"><a href="/tags/CM/" class="post__tag__link">CM</a></li><li class="post__tag__item"><a href="/tags/Python/" class="post__tag__link">Python</a></li></ul><a href="/2016/06/27/ansible-inventory-concepts/#disqus_thread" class="post__foot-link u-fr">COMMENTS</a></footer></article><div class="comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript></div></div></main><footer class="foot"><div class="foot-copy u-fl">&copy; 2018 Scarlz</div><menu class="page-menu u-fr"><li class="page-menu__item"><a title="Previous" href="/2017/02/14/installing-using-ufw/" class="page-menu__link icon-arrow-left"></a></li><li class="page-menu__item"><a title="Next" href="/2016/06/13/debian8-vps-checklist/" class="page-menu__link icon-arrow-right"></a></li></menu></footer><script>(function(h,g,l,k,j,i){j=h.createElement(g),i=h.getElementsByTagName(g)[0],
j.src="//"+l+".disqus.com/"+k+".js",i.parentNode.insertBefore(j,i)})
(document,"script","totts","embed");
</script></body></html>