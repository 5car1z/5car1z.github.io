<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="description" content="ToTT"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="alternative" href="atom.xml" title="Tricks of the Trades" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>VPS - Tricks of the Trades</title><link rel="stylesheet" href="/css/main.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--></head><body><header class="head"><h1 class="head-title u-fl"><a href="/">Tricks of the Trades</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a href="/" class="head-nav__link">Home</a></li><li class="head-nav__item"><a href="/archives" class="head-nav__link">Archives</a></li><li class="head-nav__item"><a href="/trades" class="head-nav__link">Trades</a></li><li class="head-nav__item"><a href="/work" class="head-nav__link">Work</a></li><li class="head-nav__item"><a href="/about" class="head-nav__link">About</a></li><li class="head-nav__item"><a href="/contact" class="head-nav__link">Contact</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"><time datetime="2016-06-12T23:00:00.000Z" class="post__time">June 13, 2016</time><h1 class="post__title"><a href="/2016/06/13/debian8-vps-checklist/">Debian 8 (Jessie) VPS Basic Checklist</a></h1></header><div class="post__main echo"><p><img src="http://i.imgur.com/JXNdLSN.png" alt="VPS Image"></p>
<h1 id="Preamble"><a href="#Preamble" class="headerlink" title="Preamble"></a>Preamble</h1><p>Here are some base guidelines I follow when setting up a new VPS manually without configuration management. These steps if anything make the system more secure overall and provide a good starting point from which you can setup the services/software’s required for the purpose of the VPS. </p>
<p>All of these steps in this post are from the context of a <em>droplet</em> (VPS) hosted by <a href="https://m.do.co/c/e91058dbfc7b" target="_blank" rel="external">Digital Ocean</a> using the Debian 8.5 x64 kernel images they use as of the above date. </p>
<a id="more"></a>
<hr>
<h1 id="1-–-Setup-VPS-User-Account"><a href="#1-–-Setup-VPS-User-Account" class="headerlink" title="1 – Setup VPS User Account"></a>1 – Setup VPS User Account</h1><p>Initial root access for this section is assumed. Adding a registered SSH public key to the droplet creation on Digital Ocean gives pass-wordless root access to the VPS. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh root@your.vps.ip.address</span><br></pre></td></tr></table></figure>
<p>Install the <code>sudo</code> package manually as this is not included with Digital Ocean’s Debian 8 image.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ apt-get install sudo</span><br></pre></td></tr></table></figure>
<p>Add your new Linux user to the system. Whenever you see <code>scarlz</code> here in commands it should be replaced with your own preferred username, and substituted in from throughout. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ adduser scarlz</span><br></pre></td></tr></table></figure>
<p>Add the newly created user to the <code>sudo</code> elevation privileges group.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ adduser scarlz sudo</span><br></pre></td></tr></table></figure>
<p>You can also add the user to the <code>adm</code> group which grants read access to system log files if you think this would be useful. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ adduser scarlz adm</span><br></pre></td></tr></table></figure>
<p>Exit the root SSH session. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">exit</span></span><br></pre></td></tr></table></figure>
<hr>
<h1 id="2-–-Copy-Client-Public-SSH-Key"><a href="#2-–-Copy-Client-Public-SSH-Key" class="headerlink" title="2 – Copy Client Public SSH Key"></a>2 – Copy Client Public SSH Key</h1><p>Install your public key to the new user added in the previous step. </p>
<p>Do this by running the <code>ssh-copy-id</code> command, supplying it with the the username and IP address of the VPS. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-copy-id scarlz@your.vps.ip.address</span><br></pre></td></tr></table></figure>
<p>The public key (after authentication) will be added to the remote user’s <code>~/.ssh/authorized_keys</code> file. </p>
<p>As long as the client has the private key tied to the public key just registered, it can be used to log into the VPS. </p>
<hr>
<h1 id="3-–-Update-and-Install-System-Packages"><a href="#3-–-Update-and-Install-System-Packages" class="headerlink" title="3 – Update and Install System Packages"></a>3 – Update and Install System Packages</h1><p>SSH back into the VPS as the new user you created previously, which should work without requiring authentication details thanks to the previous step. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh scarlz@your.vps.ip.address</span><br></pre></td></tr></table></figure>
<p>Run this command to ensure the system’s packages are up to date. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get update &amp;&amp; sudo apt-get upgrade</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="4-–-Default-SSH-Port-and-Root-Access"><a href="#4-–-Default-SSH-Port-and-Root-Access" class="headerlink" title="4 – Default SSH Port and Root Access"></a>4 – Default SSH Port and Root Access</h1><p>This step removes the assumption any port scanning makes on what port number the SSH service is running on. The default is <code>22</code> so these processes will check for that first and foremost. Changing this number to an ephemeral port can help to reduce the number of attempted malicious login attempts that are made. However there are several finer points as to why you might not want to do this, so decide if this seems worthwhile or not before doing it (see the next link). </p>
<blockquote>
<p><strong>Note:</strong> <a href="http://security.stackexchange.com/questions/32308/should-i-change-the-default-ssh-port-on-linux-servers" target="_blank" rel="external">Should I change the default SSH port on linux servers?</a></p>
</blockquote>
<p>All I  would say is don’t get into the habit of doing this for other service’s port numbers. If you choose not to do this then Fail2ban (which we install later) will be enough in its place. </p>
<p>Disabling password authentication for the root user account and relying on the registered SSH key can also put a stop to attempted root logins from unwanted hosts. </p>
<p>Change the VPS’s default SSH port &amp; disable root login via passwords in the system wide SSH config file.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vim /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure>
<p>Change the <code>Port 22</code> entry to any number between <code>1025</code> and <code>65536</code> respectively, if you have decided you want to do this.  </p>
<p>For example:</p>
<figure class="highlight bash"><figcaption><span>/etc/ssh/sshd_config</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Port 3267</span><br></pre></td></tr></table></figure>
<p>Change the <code>PermitRootLogin yes</code> entry to <code>PermitRootLogin without-password</code> instead,</p>
<p>This as mentioned before means only users with public SSH keys registered in the root authorised keys file can log in as root itself. </p>
<figure class="highlight bash"><figcaption><span>/etc/ssh/sshd_config</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PermitRootLogin without-password</span><br></pre></td></tr></table></figure>
<p>Restart SSH so the changes take effect.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo service ssh restart</span><br></pre></td></tr></table></figure>
<p>When accessing the VPS via SSH in the future, you must now append the correct port number to the command e.g.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh scarlz@your.vps.ip.address -p 3267</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="5-–-Automatic-Security-Upgrades"><a href="#5-–-Automatic-Security-Upgrades" class="headerlink" title="5 – Automatic Security Upgrades"></a>5 – Automatic Security Upgrades</h1><p>Using a package named <code>unattended-upgrades</code> it’s possible to have updates done by the package manager automatically at set intervals. It is advised to only enable security updating and not the normal package upgrading as this could potentially cause problems with conflicts or unwanted changes. </p>
<p>Install the package to begin with.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install unattended-upgrades</span><br></pre></td></tr></table></figure>
<p>Open/create the <code>10periodic</code> configuration file for this package using your preferred text editor.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vim /etc/apt/apt.conf.d/10periodic</span><br></pre></td></tr></table></figure>
<p>Add in the lines found in the below code snippet:</p>
<figure class="highlight bash"><figcaption><span>/etc/apt/apt.conf.d/10periodic</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">APT::Periodic::Update-Package-Lists <span class="string">"1"</span>;</span><br><span class="line">APT::Periodic::Download-Upgradeable-Packages <span class="string">"1"</span>;</span><br><span class="line">APT::Periodic::AutocleanInterval <span class="string">"7"</span>;</span><br><span class="line">APT::Periodic::Unattended-Upgrade <span class="string">"1"</span>;</span><br></pre></td></tr></table></figure>
<p>Save your additions and exit the file. </p>
<p>Now open up another configuration file named <code>50unattended-upgrades</code> for changes.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vim /etc/apt/apt.conf.d/50unattended-upgrades</span><br></pre></td></tr></table></figure>
<p>Enable security updates only by adding the line - <code>&quot;origin=Debian,codename=${distro_codename},label=Debian-Security&quot;;</code> to the correct location, as shown in the next code snippet on line 17:</p>
<figure class="highlight bash"><figcaption><span>/etc/apt/apt.conf.d/50unattended-upgrades</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Unattended-Upgrade::Origins-Pattern &#123;</span><br><span class="line">        // Codename based matching:</span><br><span class="line">        // This will follow the migration of a release through different</span><br><span class="line">        // archives (e.g. from testing to stable and later oldstable).</span><br><span class="line">//      <span class="string">"o=Debian,n=jessie"</span>;</span><br><span class="line">//      <span class="string">"o=Debian,n=jessie-updates"</span>;</span><br><span class="line">//      <span class="string">"o=Debian,n=jessie-proposed-updates"</span>;</span><br><span class="line">//      <span class="string">"o=Debian,n=jessie,l=Debian-Security"</span>;</span><br><span class="line"></span><br><span class="line">        // Archive or Suite based matching:</span><br><span class="line">        // Note that this will silently match a different release after</span><br><span class="line">        // migration to the specified archive (e.g. testing becomes the</span><br><span class="line">        // new stable).</span><br><span class="line">//      <span class="string">"o=Debian,a=stable"</span>;</span><br><span class="line">//      <span class="string">"o=Debian,a=stable-updates"</span>;</span><br><span class="line">//      <span class="string">"o=Debian,a=proposed-updates"</span>;</span><br><span class="line">        <span class="string">"origin=Debian,codename=<span class="variable">$&#123;distro_codename&#125;</span>,label=Debian-Security"</span>;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Further down in the file add an email address thatcan receive the update reports and uncomment the line itself: </p>
<figure class="highlight bash"><figcaption><span>/etc/apt/apt.conf.d/50unattended-upgrades</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// Send email to this address <span class="keyword">for</span> problems or packages upgrades</span><br><span class="line">// If empty or <span class="built_in">unset</span> <span class="keyword">then</span> no email is sent, make sure that you</span><br><span class="line">// have a working mail setup on your system. A package that provides</span><br><span class="line">// <span class="string">'mailx'</span> must be installed. E.g. <span class="string">"user@example.com"</span></span><br><span class="line">Unattended-Upgrade::Mail <span class="string">"user@email-domain.com"</span>;</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="6-–-Setup-Dotfiles-Optional"><a href="#6-–-Setup-Dotfiles-Optional" class="headerlink" title="6 – Setup Dotfiles (Optional)"></a>6 – Setup Dotfiles (Optional)</h1><p>Most administrators or developers will have their own customised <em>dotfiles</em> they use to personalise the server and make tasks easier, or introduce extra functionality to the system. Here is where I would setup my own using Git and GitHub.   </p>
<p>It is unlikely that you’ll want to carry out the commands in this step as these instructions are for my own dotfiles, so only really relevant to me. </p>
<p><strong>Replace this step with installing and setting up your own equivalent dotfiles!</strong></p>
<blockquote>
<p><a href="https://github.com/5car1z/dotfiles" target="_blank" rel="external">https://github.com/5car1z/dotfiles</a></p>
</blockquote>
<p>Install Git via the system package manager. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install git</span><br></pre></td></tr></table></figure>
<p>Clone your dotfiles repository onto the system.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/5car1z/dotfiles.git </span><br><span class="line">$ <span class="built_in">cd</span> ~/dotfiles</span><br></pre></td></tr></table></figure>
<p>Run the two install scripts that add more packages (all the good stuff) and create the necessary symlinks using GNU Stow. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ./install-debian-ubuntu-dotfile-dependencies.sh</span><br><span class="line">$ ./stow-dotfiles.sh</span><br></pre></td></tr></table></figure>
<p>If there’s any submodule problems update them to their latest remote versions with:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ update_submodules</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="7-–-Install-Software-Packages"><a href="#7-–-Install-Software-Packages" class="headerlink" title="7 – Install Software Packages"></a>7 – Install Software Packages</h1><p>Any outstanding or super essential packages that haven’t been brought in by the “dotfiles” step should be considered before moving on. What these are will be known only to you though as everybody’s preferences and needs are different. </p>
<p>Here are several examples however. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install git vim curl cowsay fortune-mod jq vim tmux ranger</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="8-–-Install-and-Run-UFW"><a href="#8-–-Install-and-Run-UFW" class="headerlink" title="8 – Install and Run UFW"></a>8 – Install and Run UFW</h1><p>UFW stands for “Uncomplicated Firewall” and is more concise easier to understand alternative to older firewall implementations like <a href="http://www.tricksofthetrades.net/2015/05/18/iptables-ipv4/">iptables</a>.  </p>
<p>Install on Debian 8 like any other package simply using:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install ufw</span><br></pre></td></tr></table></figure>
<p>Like with other firewalls of this elk it’s common practice to put in place a blanket set of ingress/egress rules then add the exceptions to services and ports on top afterwards. </p>
<p>Make the default overall action for any incoming traffic to be blocked and denied. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw default deny incoming</span><br></pre></td></tr></table></figure>
<p>Then make the default overall action for outgoing traffic to be permissible and allowed. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw default allow outgoing</span><br></pre></td></tr></table></figure>
<p>From here, any services you wish to allow that are received by the VPS can be added as an exception. See a separate post that covers the key areas of UFW in itself for information on how to do this. </p>
<blockquote>
<p><a href="http://www.tricksofthetrades.net/2017/02/14/installing-using-ufw/">Full UFW Guide</a></p>
</blockquote>
<p>To continue here, open the SSH port number you chose earlier on by replacing the number <code>3267</code> with your own number, in the following command.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw allow 3267/tcp</span><br></pre></td></tr></table></figure>
<p>Lastly after all the extra rules you need, enable the firewall so the configuration becomes active. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ufw <span class="built_in">enable</span></span><br></pre></td></tr></table></figure>
<hr>
<h1 id="9-–-Install-and-Run-Fail2ban"><a href="#9-–-Install-and-Run-Fail2ban" class="headerlink" title="9 – Install and Run Fail2ban"></a>9 – Install and Run Fail2ban</h1><p>This application permanently stops any excessive failed attempts (brute forcing) at connecting to the VPS - it achieves this by banning the offending source IP. This is configurable over various services on the system and not just SSH. </p>
<p>Install it as done before with the system package manager. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install fail2ban sendmail</span><br></pre></td></tr></table></figure>
<p>Sendmail can also be used by Fail2ban when sending out notification messages for bans that have occurred, so this is useful to install alongside it. Unless you want to configure it to use a different mail service. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo sed <span class="string">'s/^banaction = .*/banaction = ufw/'</span> /etc/fail2ban/jail.conf &gt; /etc/fail2ban/jail.local</span><br></pre></td></tr></table></figure>
<p>Start the service and ensure it’s running by ussing the command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo service fail2ban start</span><br></pre></td></tr></table></figure>
<p>A more detailed rundown of the configuration involved with Fail2ban is covered in a separate post to this one. </p>
<blockquote>
<p><a href="">Full Fail2ban Guide - To Be Added</a></p>
</blockquote>
<hr>
<p>This is a pretty straightforward post, all things considered. Remember that a persons needs for configuring a VPS will be tailored to their own requirements, criteria, and preferences. So these steps are good general outline but mainly the ones I personally follow - other people’s will be different, according to their needs. </p>
<p><strong>More Information</strong></p>
<ul>
<li><a href="https://www.digitalocean.com/community/tutorials/initial-server-setup-with-debian-8" target="_blank" rel="external">Digital Ocean - Initial Server Setup with Debian 8</a> – Partial inspiration for this post. </li>
<li><a href="https://www.reddit.com/r/netsec/comments/4o7wpo/my_first_10_minutes_on_a_server/" target="_blank" rel="external">Reddit Thread - My First 10 Minutes On a Server</a> – Reddit thread that links to an article on best security practives to follow when setting up a VPS/server. </li>
<li><a href="https://wiki.debian.org/UnattendedUpgrades" target="_blank" rel="external">Debian Wiki - Unattended Upgrades</a> – Helpful explanation and information on how to use the configuration files. </li>
<li><a href="https://www.digitalocean.com/community/questions/what-is-your-server-security-check-list" target="_blank" rel="external">Digital Ocean - What is your server security check list?</a> – November 29, 2016 Question Thread.</li>
</ul>
<blockquote>
<p>Easily deploy an SSD cloud server on <a href="https://www.digitalocean.com/?refcode=e91058dbfc7b" target="_blank" rel="external">Digital Ocean</a> in 55 seconds. Sign up using my link and receive $10.00 in free credit: <a href="https://www.digitalocean.com/?refcode=e91058dbfc7b" target="_blank" rel="external">https://www.digitalocean.com/?refcode=e91058dbfc7b</a></p>
</blockquote>
<p>– Scarlz: <a href="https://twitter.com/5car1z" target="_blank" rel="external">@5car1z</a></p>
</div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/Debian/" class="post__tag__link">Debian</a></li><li class="post__tag__item"><a href="/tags/Jessie/" class="post__tag__link">Jessie</a></li><li class="post__tag__item"><a href="/tags/VPS/" class="post__tag__link">VPS</a></li></ul><a href="/2016/06/13/debian8-vps-checklist/#disqus_thread" class="post__foot-link u-fr">COMMENTS</a></footer></article><article class="post"><header class="post__head"><time datetime="2015-01-15T00:00:00.000Z" class="post__time">January 15, 2015</time><h1 class="post__title"><a href="/2015/01/15/web-deployment-git-hooks/">Debian 7 Web Server Deployment with Git Hooks</a></h1></header><div class="post__main echo"><p><img src="http://i.imgur.com/p0i25Hx.png" alt="Github Logo"></p>
<p>Some notes on how to use a git hook for web server deployment on Debian 7.</p>
<ul>
<li>Web server live directory: <code>/var/www</code></li>
<li>Web server live directory with virtual hosts: <code>/var/www/www.exampledomain.com</code></li>
<li>VPS “live” repository: <code>/var/repo-name/project-name</code></li>
</ul>
<a id="more"></a>
<hr>
<p>SSH into the server or VPS and create the following folders in the respective directories.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /var</span><br><span class="line">$ mkdir repository-name</span><br><span class="line">$ <span class="built_in">cd</span> repository-name</span><br><span class="line">$ mkdir project-name </span><br><span class="line">$ <span class="built_in">cd</span> project-name</span><br></pre></td></tr></table></figure></p>
<p>Use bare to initialise only the version control components of git and not any other of the source files. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git init --bare</span><br></pre></td></tr></table></figure>
<p>Change into the <code>hooks</code> directory and create a text file named <code>post-receive</code> and begin writing to it. I’m using vim in this example. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> hooks</span><br><span class="line">$ vim post-receive</span><br></pre></td></tr></table></figure>
<p>Enter the following lines for a single web server host, or <strong>skip</strong> to the next code block for multiple virtual hosts. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">git --work-tree=/var/www --git-dir=/var/loy-web/loy-website checkout <span class="_">-f</span></span><br></pre></td></tr></table></figure>
<p>For multiple virtual hosts enter this coding instead:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">git --work-tree=/var/www/www.example-domain.com --git-dir=/var/repo-name/project-name checkout <span class="_">-f</span></span><br></pre></td></tr></table></figure>
<p>Turn the newly created and completed <code>post-receive</code> file into a an executable file. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ chmod +x post-receive</span><br></pre></td></tr></table></figure>
<p>On a user’s local git repository (the repository used previously for the same project, and for development of the website) add  the remote path of our server repository like so.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add live ssh://user@vps_address/var/repo-name/project-name</span><br></pre></td></tr></table></figure>
<p>Push to the ‘live’ remote on the ‘master’ branch which will then update the specified web server hosting directory. Which in this case was <code>/var/www</code> or <code>/var/www/www.example-domain.com</code> for multiple virtual hosts. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push live master</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Easily deploy an SSD cloud server on <a href="https://www.digitalocean.com/?refcode=e91058dbfc7b" target="_blank" rel="external">Digital Ocean</a> in 55 seconds. Sign up using my link and receive $10.00 in free credit: <a href="https://www.digitalocean.com/?refcode=e91058dbfc7b" target="_blank" rel="external">https://www.digitalocean.com/?refcode=e91058dbfc7b</a></p>
</blockquote>
<p>– Scarlz: <a href="https://twitter.com/5car1z" target="_blank" rel="external">@5car1z</a></p>
</div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/Debian/" class="post__tag__link">Debian</a></li><li class="post__tag__item"><a href="/tags/VPS/" class="post__tag__link">VPS</a></li><li class="post__tag__item"><a href="/tags/Git/" class="post__tag__link">Git</a></li></ul><a href="/2015/01/15/web-deployment-git-hooks/#disqus_thread" class="post__foot-link u-fr">COMMENTS</a></footer></article><article class="post"><header class="post__head"><time datetime="2014-10-12T23:00:00.000Z" class="post__time">October 13, 2014</time><h1 class="post__title"><a href="/2014/10/13/vps-basic-checklist/">Debian 7 (Wheezy) VPS Basic Checklist</a></h1></header><div class="post__main echo"><p><img src="http://i.imgur.com/JXNdLSN.png" alt="VPS Cloud"></p>
<h1 id="Preamble"><a href="#Preamble" class="headerlink" title="Preamble"></a>Preamble</h1><p>This is intended primarily as a set of notes for myself but you might find the listed items of use, as the following are often commonplace and somewhat standardly used. </p>
<p>Consider also that a persons needs for configuring a VPS will be tailored to their own requirements, criteria, and preferences. These are notes mostly for my benefit.  </p>
<p><strong>This post is focused around Debian and its derivatives.</strong> </p>
<a id="more"></a>
<hr>
<h1 id="Admin-Account"><a href="#Admin-Account" class="headerlink" title="Admin Account"></a>Admin Account</h1><p>Assuming initial root access for this section:</p>
<p><strong>Add a new user</strong> </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ adduser scarlz</span><br></pre></td></tr></table></figure>
<p><strong>Add the newly created user to the <code>sudo</code> elevation privileges group</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ adduser scarlz sudo</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="Repositories-Packages"><a href="#Repositories-Packages" class="headerlink" title="Repositories/Packages"></a>Repositories/Packages</h1><p>SSH into the newly created user, and use from now onwards.</p>
<figure class="highlight bash"><figcaption><span>username@the.vps.ip.address</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh scarlz@the.vps.ip.address</span><br></pre></td></tr></table></figure>
<p><strong>Make sure system repositories are up to date</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get update </span><br><span class="line">$ sudo apt-get upgrade</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="LAMP"><a href="#LAMP" class="headerlink" title="LAMP"></a>LAMP</h1><h2 id="Apache"><a href="#Apache" class="headerlink" title="Apache"></a>Apache</h2><p><strong>Install apache web server</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install apache2</span><br></pre></td></tr></table></figure>
<h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><p><strong>Install MySQL and complete the prompts</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install mysql-server</span><br></pre></td></tr></table></figure>
<h2 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h2><p><strong>Install PHP</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install php5-common libapache2-mod-php5 php5-cli</span><br></pre></td></tr></table></figure>
<p><a href="http://php.net/manual/en/install.unix.debian.php" target="_blank" rel="external">PHP Official Debian GNU/Linux Installation Notes</a></p>
<hr>
<h1 id="SSH-Default-Port-amp-Root-Access"><a href="#SSH-Default-Port-amp-Root-Access" class="headerlink" title="SSH Default Port &amp; Root Access"></a>SSH Default Port &amp; Root Access</h1><p><strong>Change the VPS’s default SSH port &amp; Disable Root login</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vim /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure>
<p><em>Change the “Port 22” entry to any number between 1025 and 65536</em></p>
<blockquote>
<p><strong>Port 3267</strong></p>
</blockquote>
<ul>
<li>Change the “PermitRootLogin yes” entry to “PermitRootLogin without-password”*</li>
</ul>
<p>This means only users with public SSH keys registered in the authorised keys file can log in as root. </p>
<blockquote>
<p><strong>PermitRootLogin without-password</strong></p>
</blockquote>
<p><strong>Restart SSH</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo service ssh restart</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="SSH-Keys"><a href="#SSH-Keys" class="headerlink" title="SSH Keys"></a>SSH Keys</h1><p>On the client machine.</p>
<p><strong>Generate RSA key pair</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -t rsa</span><br></pre></td></tr></table></figure>
<p><strong>Copy public key into the authorized_keys file on the VPS</strong> </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-copy-id scarlz@the.vps.ip.address</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="iptables-Setup"><a href="#iptables-Setup" class="headerlink" title="iptables Setup"></a>iptables Setup</h1><p><strong>Display current rules in table</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo iptables -L -v</span><br></pre></td></tr></table></figure>
<p><strong>Add standard rules</strong></p>
<p>Line 4 below <code>--dport 3267</code> Should be whatever value SSH was altered to earlier on.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo iptables -A INPUT -i lo -j ACCEPT -m comment --comment <span class="string">"allow loopback address"</span></span><br><span class="line">$ sudo iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT -m comment --comment <span class="string">"maintain all current connections"</span></span><br><span class="line">$ sudo iptables -A INPUT -p tcp --dport 80 -j ACCEPT -m comment --comment <span class="string">"allow connections on port 80 HTTP"</span></span><br><span class="line">$ sudo iptables -A INPUT -p tcp --dport 3267 -j ACCEPT -m comment --comment <span class="string">"allow connections on port 3267 SSH"</span></span><br></pre></td></tr></table></figure>
<h2 id="ICMP-Ping-Rules"><a href="#ICMP-Ping-Rules" class="headerlink" title="ICMP (Ping) Rules"></a>ICMP (Ping) Rules</h2><p><strong>Create an IP address variable</strong></p>
<figure class="highlight bash"><figcaption><span>SERVER_IP=your.vps.server.ip</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ SERVER_IP=189.56.33.99</span><br></pre></td></tr></table></figure>
<p><strong>Add <code>echo-reply</code> and <code>echo-request</code> rules</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo iptables -A INPUT -p icmp --icmp-type 8 <span class="_">-s</span> 0/0 <span class="_">-d</span> <span class="variable">$SERVER_IP</span> -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT -m comment --comment <span class="string">"ICMP echo-reply"</span></span><br><span class="line">$ sudo iptables -A OUTPUT -p icmp --icmp-type 0 <span class="_">-s</span> <span class="variable">$SERVER_IP</span> <span class="_">-d</span> 0/0 -m state --state ESTABLISHED,RELATED -j ACCEPT -m comment --comment <span class="string">"ICMP echo-request"</span></span><br></pre></td></tr></table></figure>
<h2 id="Add-Final-Rule"><a href="#Add-Final-Rule" class="headerlink" title="Add Final Rule"></a>Add Final Rule</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo iptables -P INPUT DROP -m comment --comment <span class="string">"block/drop all remaining connections"</span></span><br></pre></td></tr></table></figure>
<h2 id="Saving-the-Configuration"><a href="#Saving-the-Configuration" class="headerlink" title="Saving the Configuration"></a>Saving the Configuration</h2><p><strong>Save the config by using the package below</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install iptables-persistent</span><br></pre></td></tr></table></figure>
<p><strong>Start the service</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo service iptables-persistent start</span><br></pre></td></tr></table></figure>
<hr>
<blockquote>
<p>Easily deploy an SSD cloud server on <a href="https://www.digitalocean.com/?refcode=e91058dbfc7b" target="_blank" rel="external">Digital Ocean</a> in 55 seconds. Sign up using my link and receive $10.00 in free credit: <a href="https://www.digitalocean.com/?refcode=e91058dbfc7b" target="_blank" rel="external">https://www.digitalocean.com/?refcode=e91058dbfc7b</a></p>
</blockquote>
<p>– Scarlz: <a href="https://twitter.com/5car1z" target="_blank" rel="external">@5car1z</a></p>
</div><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a href="/tags/Debian/" class="post__tag__link">Debian</a></li><li class="post__tag__item"><a href="/tags/VPS/" class="post__tag__link">VPS</a></li><li class="post__tag__item"><a href="/tags/Wheezy/" class="post__tag__link">Wheezy</a></li></ul><a href="/2014/10/13/vps-basic-checklist/#disqus_thread" class="post__foot-link u-fr">COMMENTS</a></footer></article></main><footer class="foot"><div class="foot-copy u-fl">&copy; 2017 Scarlz</div><menu class="page-menu u-fr"><li class="page-menu__item"><span title="Previous" class="page-menu__link icon-arrow-left page-menu__link--disabled"></span></li><li class="page-menu__item"><span title="Next" class="page-menu__link icon-arrow-right page-menu__link--disabled"></span></li></menu></footer><script>(function(h,g,l,k,j,i){j=h.createElement(g),i=h.getElementsByTagName(g)[0],
j.src="//"+l+".disqus.com/"+k+".js",i.parentNode.insertBefore(j,i)})
(document,"script","totts","count");
</script></body></html>